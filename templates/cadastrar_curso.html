<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Curso</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#c1f38e;
      --primary:#a0e76d;
      --primary-hover:#8dd24a;
      --surface:#ffffff;
      --border:#e2e8f0;
      --text:#1f2937;
      --muted:#64748b;
      --shadow:0 8px 22px rgba(0,0,0,.08);
      --radius:16px; --radius-sm:12px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Poppins',sans-serif;
      min-height:100vh; background:var(--bg); color:var(--text);
      display:grid; grid-template-columns:260px 1fr; gap:22px;
    }

    /* === SIDEBAR === */
    .sidebar{background:var(--surface);border-right:1px solid var(--border);padding:18px 16px;display:flex;flex-direction:column;gap:16px}
    .brand{background:#f4ffe7;border:1px solid var(--border);border-radius:12px;padding:10px;display:flex;align-items:center;justify-content:center}
    .brand img{height:32px;width:auto;display:block}

    /* Perfil (logo -> avatar -> nome) */
    .profile{
      background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);
      padding:14px;display:flex;flex-direction:column;align-items:center;gap:10px
    }
    .avatar-wrap{position:relative;width:86px;height:86px}
    .avatar{
      width:86px;height:86px;border-radius:50%;
      background-position:center;background-size:cover;background-repeat:no-repeat;
      border:3px solid #d9f5b6; /* aro verde claro */
    }
    .avatar-btn{
      position:absolute;right:-4px;bottom:-4px;
      background:var(--primary);border:none;border-radius:999px;padding:6px 8px;
      font-weight:700;cursor:pointer;line-height:1;box-shadow:0 2px 6px rgba(0,0,0,.15)
    }
    .avatar-btn:hover{background:var(--primary-hover)}
    .user-name{
      text-align:center;font-weight:700;color:#222;font-size:14px;letter-spacing:.02em;text-transform:uppercase
    }

    .btn{width:100%;display:inline-block;text-align:center;padding:10px 14px;border:none;border-radius:10px;background:var(--primary);color:#333;font-weight:600;text-decoration:none;cursor:pointer;transition:.15s ease}
    .btn:hover{background:var(--primary-hover)}
    .btn.secondary{background:#eef2f6;color:#111;border:1px solid var(--border)}

    /* === CONTEÚDO === */
    .content{padding:22px 22px 40px 0;max-width:1200px}
    .breadcrumb{font-size:12px;color:var(--muted);margin:6px 0 12px;text-align:right}
    .page-title{font-size:26px;font-weight:700;margin-bottom:14px;color:#213547}

    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .card h3{font-size:18px;margin-bottom:12px}

    .grid{display:grid;gap:14px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    @media (max-width:980px){ body{grid-template-columns:1fr} .grid.cols-2{grid-template-columns:1fr}}

    .field{display:flex;flex-direction:column;gap:8px}
    .field label{font-weight:600;font-size:14px;color:#444}
    .field input[type="text"], .field select, .field textarea, .field input[type="file"]{padding:10px;border:1px solid #ccc;border-radius:6px;font-size:14px;color:#333;background:#fff}
    .field textarea{min-height:120px;resize:vertical}

    .section-title{font-size:18px;font-weight:700;color:#333;margin:18px 0 10px}
    #modulos .modulo{background:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:12px}
    .modulo .top-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:start}
    .btn-danger{background:#dc3545;color:#fff;border:none;border-radius:8px;padding:8px 10px;font-weight:600;cursor:pointer}
    .btn-danger:hover{background:#b02a37}
    #perguntas .pergunta{background:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:10px}
    .pergunta .header-pergunta{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .actions .btn{flex:1}
  </style>
</head>
<body>

  <!-- === SIDEBAR === -->
  <aside class="sidebar">
    <!-- LOGO (obrigatória) -->
    <div class="brand">
      <img src="{{ url_for('static', filename='loggo.png') }}" alt="Ambipar EAD">
    </div>

    <!-- PERFIL: Avatar editável + Nome da pessoa logada -->
    <div class="profile">
      <div class="avatar-wrap">
        <div
          class="avatar"
          style="
            background-image:
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.webp') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpeg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.png') }}'),
              url('{{ url_for('static', filename='avatar_padrao.png') }}');
          ">
        </div>
        <!-- botão editar (abre input de arquivo escondido) -->
        <button class="avatar-btn" type="button" title="Trocar foto" onclick="document.getElementById('fotoInputProf').click()">✎</button>
        <form id="fotoFormProf" action="{{ url_for('upload_foto') }}" method="POST" enctype="multipart/form-data" style="display:none">
          <input id="fotoInputProf" type="file" name="foto" accept=".png,.jpg,.jpeg,.webp" onchange="document.getElementById('fotoFormProf').submit()">
        </form>
      </div>
      <div class="user-name">
        {{ (session['nome'] or 'USUÁRIO') | upper }}
      </div>
    </div>

    <!-- Botões existentes (funcionais) -->
    <a class="btn" href="/alterar_senha">Alterar Senha</a>
    <a class="btn secondary" href="/">Home do Professor</a>
  </aside>

  <!-- === CONTEÚDO === -->
  <main class="content">
    <div class="breadcrumb">Início / Professor / Cadastro de Curso</div>
    <div class="page-title">Cadastro de Curso</div>

    <section class="card">
      <h3>Informações do Curso</h3>
      <form method="post" enctype="multipart/form-data">
        <div class="grid cols-2">
          <div class="field">
            <label for="nome">Nome do Curso</label>
            <select id="nome" name="nome" required onchange="preencherConteudo()">
              <option value="">-- Selecione --</option>
              <option value="Doutrinamento Básico de Solo">Doutrinamento Básico de Solo</option>
              <option value="Conhecimentos Gerais">Conhecimentos Gerais</option>
              <option value="Emergências Gerais">Emergências Gerais</option>
              <option value="SGSO">SGSO</option>
              <option value="Transporte Aeromédico">Transporte Aeromédico</option>
              <option value="Sobrevivência na Selva">Sobrevivência na Selva</option>
              <option value="Instrutor de Voo">Instrutor de Voo</option>
              <option value="Examinador">Examinador</option>
              <option value="BELL 206-B06">BELL 206-B06</option>
              <option value="AS350 SERIES-B,BA,B2,AS50">AS350 SERIES-B,BA,B2,AS50</option>
              <option value="AS 365 SERIES (N,N1,N2)/AS65">AS 365 SERIES (N,N1,N2)/AS65</option>
              <option value="AS 355 SERIES (F,F1,F2,NP)/AS55">AS 355 SERIES (F,F1,F2,NP)/AS55</option>
              <option value="AS330J">AS330J</option>
              <option value="AS350B-BA">AS350B-BA</option>
              <option value="AS350B2-B3">AS350B2-B3</option>
              <option value="Arriel1 Series">Arriel1 Series</option>
              <option value="RR250-C20 Series">RR250-C20 Series</option>
              <option value="AS355 Series">AS355 Series</option>
              <option value="Treinamento Solo AS350">Treinamento Solo AS350</option>
              <option value="Treinamento Solo BH06">Treinamento Solo BH06</option>
              <option value="Treinamento Solo AS355">Treinamento Solo AS355</option>
            </select>
          </div>

          <div class="field">
            <label for="carga_horaria">Carga Horária</label>
            <input type="text" id="carga_horaria" name="carga_horaria" required>
          </div>

          <div class="field" style="grid-column:1/-1">
            <label for="conteudo">Conteúdo Programático</label>
            <textarea id="conteudo" name="conteudo" required></textarea>
          </div>
        </div>

        <div class="section-title">Módulos do Curso</div>
        <div id="modulos"></div>
        <button type="button" class="btn" onclick="adicionarModulo()">Adicionar Módulo</button>

        <div class="section-title">Avaliação</div>
        <div id="perguntas"></div>
        <button type="button" id="adicionarPergunta" class="btn">Adicionar Pergunta</button>

        <div class="actions">
          <input type="submit" class="btn" value="Cadastrar Curso">
          <a class="btn secondary" href="/">Cancelar</a>
        </div>
      </form>
    </section>
  </main>

  <script>
    // === Conteúdos (complete com o seu dicionário completo) ===
    const conteudos = {
      "Doutrinamento Básico de Solo": `(1) Atribuições e responsabilidades do tripulante, conforme aplicável;
(2) As apropriadas provisões deste regulamento;
(3) Conteúdo do certificado e das especificações operativas;
(4) Apropriadas partes do manual geral da empresa do detentor de certificado;
(5) O transporte seguro de artigos perigosos por via aérea, em conformidade com os requisitos do RBAC N° 175;
(6) O SGSO;
(7) Segurança da aviação civil (AVSEC);
(8) Fatores humanos e CRM`
    };
    function preencherConteudo(){ const n=document.getElementById('nome').value; document.getElementById('conteudo').value = conteudos[n] || ''; }

    // === Módulos ===
    let indexModulo=0;
    function adicionarModulo(){
      const c=document.getElementById("modulos");
      const d=document.createElement("div");
      d.className="modulo";
      d.innerHTML=`
        <div class="top-row">
          <div>
            <label>Título do Módulo:</label>
            <input type="text" name="modulos[${indexModulo}][titulo]" required>
            <label style="margin-top:8px;">Arquivo (PDF):</label>
            <input type="file" name="modulos[${indexModulo}][arquivo]" accept=".pdf" required>
          </div>
          <button type="button" class="btn-danger" onclick="this.closest('.modulo').remove()">Remover Módulo</button>
        </div>`;
      c.appendChild(d); indexModulo++;
    }

    // === Perguntas ===
    let indicePergunta=0;
    document.getElementById('adicionarPergunta').addEventListener('click', ()=>{
      const c=document.getElementById('perguntas');
      const d=document.createElement('div');
      d.className='pergunta';
      d.innerHTML=`
        <div class="header-pergunta">
          <strong>Pergunta ${indicePergunta+1}</strong>
          <button type="button" class="btn-danger" onclick="this.closest('.pergunta').remove()">Remover Pergunta</button>
        </div>
        <label>Enunciado:</label>
        <input type="text" name="perguntas[${indicePergunta}][enunciado]" required>
        <label>a)</label><input type="text" name="perguntas[${indicePergunta}][a]" required>
        <label>b)</label><input type="text" name="perguntas[${indicePergunta}][b]" required>
        <label>c)</label><input type="text" name="perguntas[${indicePergunta}][c]" required>
        <label>d)</label><input type="text" name="perguntas[${indicePergunta}][d]" required>
        <label>Alternativa correta:</label>
        <select name="perguntas[${indicePergunta}][correta]" required>
          <option value="a">a</option><option value="b">b</option>
          <option value="c">c</option><option value="d">d</option>
        </select>`;
      c.appendChild(d); indicePergunta++;
    });
  </script>
</body>
</html>
