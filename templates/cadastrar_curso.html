<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Curso</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#c1f38e;
      --primary:#a0e76d;
      --primary-hover:#8dd24a;
      --surface:#ffffff;
      --border:#e2e8f0;
      --text:#1f2937;
      --muted:#64748b;
      --shadow:0 8px 22px rgba(0,0,0,.08);
      --radius:16px; --radius-sm:12px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Poppins',sans-serif;
      min-height:100vh; background:var(--bg); color:var(--text);
      display:grid; grid-template-columns:260px 1fr; gap:22px;
    }

    .sidebar{background:var(--surface);border-right:1px solid var(--border);padding:18px 16px;display:flex;flex-direction:column;gap:16px}
    .brand{background:#f4ffe7;border:1px solid var(--border);border-radius:12px;padding:10px;display:flex;align-items:center;justify-content:center}
    .brand img{height:32px;width:auto;display:block}

    .profile{
      background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);
      padding:14px;display:flex;flex-direction:column;align-items:center;gap:10px
    }
    .avatar{
      width:86px;height:86px;border-radius:50%;
      background:url('{{ url_for("static", filename="avatar_padrao.png") }}') center/cover no-repeat;
      border:3px solid #d9f5b6;
    }
    .user-name{
      text-align:center;font-weight:700;color:#222;font-size:14px;letter-spacing:.02em;text-transform:uppercase
    }

    .btn{width:100%;display:inline-block;text-align:center;padding:10px 14px;border:none;border-radius:10px;background:var(--primary);color:#333;font-weight:600;text-decoration:none;cursor:pointer;transition:.15s ease}
    .btn:hover{background:var(--primary-hover)}
    .btn.secondary{background:#eef2f6;color:#111;border:1px solid var(--border)}

    .content{padding:22px 22px 40px 0;max-width:1200px}
    .breadcrumb{font-size:12px;color:var(--muted);margin:6px 0 12px;text-align:right}
    .page-title{font-size:26px;font-weight:700;margin-bottom:14px;color:#213547}

    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .card h3{font-size:18px;margin-bottom:12px}

    .grid{display:grid;gap:14px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    @media (max-width:980px){ body{grid-template-columns:1fr} .grid.cols-2{grid-template-columns:1fr}}

    .field{display:flex;flex-direction:column;gap:8px}
    .field label{font-weight:600;font-size:14px;color:#444}
    .field input[type="text"], .field select, .field textarea, .field input[type="file"]{
      padding:10px;border:1px solid #ccc;border-radius:6px;font-size:14px;color:#333;background:#fff
    }
    .field textarea{min-height:120px;resize:vertical}

    .section-title{font-size:18px;font-weight:700;color:#333;margin:18px 0 10px}
    #modulos .modulo{background:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:12px}
    .modulo .top-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:start}
    .btn-danger{background:#dc3545;color:#fff;border:none;border-radius:8px;padding:8px 10px;font-weight:600;cursor:pointer}
    .btn-danger:hover{background:#b02a37}
    #perguntas .pergunta{background:#f9f9f9;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:10px}
    .pergunta .header-pergunta{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .actions .btn{flex:1}
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="brand">
    <img src="{{ url_for('static', filename='loggo.png') }}">
  </div>

  <div class="profile">
    <div class="avatar"></div>
    <div class="user-name">{{ (session['nome'] or 'USUÁRIO') | upper }}</div>
  </div>

  <a class="btn" href="/alterar_senha">Alterar Senha</a>
  <a class="btn secondary" href="/">Home do Professor</a>
</aside>

<main class="content">
  <div class="breadcrumb">Início / Professor / Cadastro de Curso</div>
  <div class="page-title">Cadastro de Curso</div>

  <section class="card">
    <h3>Informações do Curso</h3>
    <form method="post" enctype="multipart/form-data">
      <div class="grid cols-2">

        <!-- NOME DO CURSO -->
        <div class="field">
          <label>Nome do Curso</label>
          <div style="display:flex;gap:8px;">
            <select id="nome" name="nome" required style="flex:1;">
              <option value="">-- Selecione --</option>
              <option value="Doutrinamento Básico de Solo">Doutrinamento Básico de Solo</option>
              <option value="Conhecimentos Gerais">Conhecimentos Gerais</option>
              <option value="Emergências Gerais">Emergências Gerais</option>
              <option value="SGSO">SGSO</option>
            </select>
            <button type="button" class="btn" style="width:40px;" onclick="mostrarNovoCurso()">+</button>
          </div>
          <input type="text" id="novoCurso" placeholder="Digite novo nome do curso"
                 style="display:none;margin-top:8px;" onblur="adicionarNovoCurso()">
        </div>

        <div class="field">
          <label>Carga Horária</label>
          <input type="text" name="carga_horaria" required>
        </div>

        <div class="field">
          <label>Setor do Curso</label>
          <select name="setor" required>
            <option value="">-- Selecione --</option>
            <option>Operações</option>
            <option>Manutenção</option>
            <option>SGSO</option>
            <option>Administrativo</option>
            <option>Outros</option>
          </select>
        </div>

        <div class="field" style="grid-column:1/-1">
          <label>Conteúdo Programático</label>
          <textarea name="conteudo" required></textarea>
        </div>
      </div>

      <div class="section-title">Módulos</div>
      <div id="modulos"></div>
      <button type="button" class="btn" onclick="adicionarModulo()">Adicionar Módulo</button>

      <div class="section-title">Avaliação</div>
      <div id="perguntas"></div>
      <button type="button" class="btn" id="adicionarPergunta">Adicionar Pergunta</button>

      <div class="actions">
        <input type="submit" class="btn" value="Cadastrar Curso">
        <a class="btn secondary" href="/">Cancelar</a>
      </div>
    </form>
  </section>
</main>

<script>
function mostrarNovoCurso(){
  const campo=document.getElementById("novoCurso");
  campo.style.display="block";
  campo.focus();
}

function adicionarNovoCurso(){
  const input=document.getElementById("novoCurso");
  const nome=input.value.trim();
  const select=document.getElementById("nome");

  if(nome){
    const opt=document.createElement("option");
    opt.value=nome;
    opt.textContent=nome;
    select.appendChild(opt);
    select.value=nome;
    salvarCurso(nome);
  }

  input.value="";
  input.style.display="none";
}

function salvarCurso(nome){
  let cursos=JSON.parse(localStorage.getItem("cursosCustom"))||[];
  if(!cursos.includes(nome)){
    cursos.push(nome);
    localStorage.setItem("cursosCustom",JSON.stringify(cursos));
  }
}

function carregarCursos(){
  let cursos=JSON.parse(localStorage.getItem("cursosCustom"))||[];
  const select=document.getElementById("nome");
  cursos.forEach(c=>{
    const opt=document.createElement("option");
    opt.value=c;
    opt.textContent=c;
    select.appendChild(opt);
  });
}

window.onload=carregarCursos;

let indexModulo=0;
function adicionarModulo(){
  const c=document.getElementById("modulos");
  const d=document.createElement("div");
  d.className="modulo";
  d.innerHTML=`
    <div class="top-row">
      <div>
        <label>Título do Módulo:</label>
        <input type="text" name="modulos[${indexModulo}][titulo]" required>
        <label>Arquivo PDF:</label>
        <input type="file" name="modulos[${indexModulo}][arquivo]" accept=".pdf" required>
      </div>
      <button type="button" class="btn-danger" onclick="this.closest('.modulo').remove()">Remover</button>
    </div>`;
  c.appendChild(d); indexModulo++;
}

let indicePergunta=0;
document.getElementById("adicionarPergunta").onclick=function(){
  const c=document.getElementById("perguntas");
  const d=document.createElement("div");
  d.className="pergunta";
  d.innerHTML=`
    <div class="header-pergunta">
      <strong>Pergunta ${indicePergunta+1}</strong>
      <button type="button" class="btn-danger" onclick="this.closest('.pergunta').remove()">Remover</button>
    </div>
    <label>Enunciado:</label>
    <input type="text" name="perguntas[${indicePergunta}][enunciado]" required>
    <label>a)</label><input type="text" name="perguntas[${indicePergunta}][a]" required>
    <label>b)</label><input type="text" name="perguntas[${indicePergunta}][b]" required>
    <label>c)</label><input type="text" name="perguntas[${indicePergunta}][c]" required>
    <label>d)</label><input type="text" name="perguntas[${indicePergunta}][d]" required>
    <label>Correta:</label>
    <select name="perguntas[${indicePergunta}][correta]" required>
      <option>a</option><option>b</option><option>c</option><option>d</option>
    </select>`;
  c.appendChild(d); indicePergunta++;
}
</script>
</body>
</html>
