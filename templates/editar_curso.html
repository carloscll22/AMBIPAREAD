<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Cursos Cadastrados</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#c1f38e; --surface:#fff; --border:#e2e8f0; --text:#1f2937; --muted:#64748b;
      --primary:#a0e76d; --primary-hover:#8dd24a; --shadow:0 8px 22px rgba(0,0,0,.08);
      --radius:16px; --radius-sm:12px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Poppins',sans-serif; background:var(--bg); color:var(--text);
      min-height:100vh; display:grid; grid-template-columns:260px 1fr; gap:22px; padding:22px;
    }

    /* Sidebar */
    .sidebar{background:var(--surface); border-right:1px solid var(--border); padding:18px 16px; display:flex; flex-direction:column; gap:16px}
    .brand{background:#f4ffe7; border:1px solid var(--border); border-radius:12px; padding:10px; display:flex; align-items:center; justify-content:center}
    .brand img{height:32px;width:auto;display:block}
    .profile{background:var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:14px; display:flex; flex-direction:column; align-items:center; gap:10px}
    .avatar-wrap{position:relative;width:86px;height:86px}
    .avatar{width:86px;height:86px;border-radius:50%;background-position:center;background-size:cover;background-repeat:no-repeat;border:3px solid #d9f5b6}
    .avatar-btn{position:absolute;right:-4px;bottom:-4px;background:var(--primary);border:none;border-radius:999px;padding:6px 8px;font-weight:700;cursor:pointer;line-height:1;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .avatar-btn:hover{background:var(--primary-hover)}
    .user-name{text-align:center;font-weight:700;color:#222;font-size:14px;text-transform:uppercase;letter-spacing:.02em}

    .btn-side{width:100%;display:inline-block;text-align:center;padding:10px 14px;border:none;border-radius:10px;cursor:pointer;background:var(--primary);color:#333;font-weight:600;text-decoration:none;transition:.15s ease}
    .btn-side:hover{background:var(--primary-hover)}
    .btn-side.secondary{background:#eef2f6;color:#111;border:1px solid var(--border)}

    /* Conteúdo */
    .content{padding-right:22px}
    .container{background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; max-width:1100px; margin:0 auto}
    h2{text-align:center;color:#1e293b;font-size:24px;font-weight:700}

    table{width:100%; border-collapse:separate; border-spacing:0 8px; margin-top:18px}
    thead th{background:#fff; padding:12px; text-align:left; font-weight:600; border-bottom:2px solid #cbd5e1; color:#334155}
    tbody tr{background:#fff}
    tbody td{padding:12px; border-bottom:1px solid #eef2f7; vertical-align:top}
    tbody tr:last-child td{border-bottom:none}
    tbody tr:hover{background:#e8f5d7}

    .botao{background:#0d6efd;color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700;display:inline-block;font-size:13px}
    .botao:hover{background:#084298}
    .btn-danger{background:#dc3545;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;width:100%;font-weight:700}
    .btn-danger:hover{background:#b02a37}

    .muted{color:#64748b}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e2e8f0;font-size:12px;margin:2px 4px 0 0}

    .voltar{text-align:center;margin-top:16px}
    .voltar a{text-decoration:none;color:#14532d;font-weight:700}
    .voltar a:hover{text-decoration:underline}

    @media (max-width:980px){
      body{grid-template-columns:1fr;padding:16px}
      .content{padding-right:0}
      .container{padding:16px}
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <img src="{{ url_for('static', filename='loggo.png') }}" alt="Ambipar EAD">
    </div>

    <div class="profile">
      <div class="avatar-wrap">
        <div class="avatar"
          style="
            background-image:
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.webp') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpeg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.png') }}'),
              url('{{ url_for('static', filename='avatar_padrao.png') }}');
          ">
        </div>
        <button class="avatar-btn" type="button" title="Trocar foto" onclick="document.getElementById('fotoInputProf').click()">✎</button>
        <form id="fotoFormProf" action="{{ url_for('upload_foto') }}" method="POST" enctype="multipart/form-data" style="display:none">
          <input id="fotoInputProf" type="file" name="foto" accept=".png,.jpg,.jpeg,.webp" onchange="document.getElementById('fotoFormProf').submit()">
        </form>
      </div>
      <div class="user-name">{{ (session['nome'] or 'USUÁRIO') | upper }}</div>
    </div>

    <!-- Link direto para evitar BuildError de endpoint ausente -->
    <a class="btn-side secondary" href="/professor_home">Home do Professor</a>
  </aside>

  <!-- Conteúdo -->
  <main class="content">
    <div class="container">
      <h2>Cursos Cadastrados</h2>

      <table>
        <thead>
          <tr>
            <th style="width:40%">Curso</th>
            <th style="width:15%">Carga Horária</th>
            <th style="width:25%">Turmas / NRT*</th>
            <th style="width:20%">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for curso in cursos %}
            {% set ns = namespace(nrts=[], turmas=[]) %}
            {% for m in matriculas %}
              {% if m.curso == curso.nome %}
                {% if m.nrt and m.nrt not in ns.nrts %}{% set _ = ns.nrts.append(m.nrt) %}{% endif %}
                {% if m.turma and m.turma not in ns.turmas %}{% set _ = ns.turmas.append(m.turma) %}{% endif %}
              {% endif %}
            {% endfor %}

            <tr>
              <td><strong>{{ curso.nome }}</strong></td>
              <td>{{ curso.carga_horaria or '—' }}</td>
              <td>
                {% if ns.turmas %}
                  <div class="muted">Turmas: {{ ns.turmas|length }}</div>
                {% endif %}
                {% if ns.nrts %}
                  <div>
                    NRTs:
                    {% for n in ns.nrts %}
                      <span class="pill">{{ n }}</span>
                    {% endfor %}
                  </div>
                {% else %}
                  <span class="muted">—</span>
                {% endif %}
              </td>
              <td>
                <a href="{{ url_for('editar_curso_form_handler', nome=curso.nome) }}" class="botao">Editar</a>

                <form method="POST" action="{{ url_for('remover_curso') }}"
                      onsubmit="return confirm('Tem certeza que deseja excluir este curso?');"
                      style="margin-top:8px;">
                  <input type="hidden" name="curso" value="{{ curso.nome }}">
                  <button type="submit" class="btn-danger">Excluir</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <p class="muted" style="margin-top:8px;">
        * <strong>Turmas/NRT</strong> são calculados a partir das matrículas do curso.
      </p>

      <div class="voltar">
        <a href="/">← Voltar à Home</a>
      </div>
    </div>
  </main>
</body>
</html>
