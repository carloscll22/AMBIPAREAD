<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cursos Cadastrados</title>
  <style>
    body {
      background-color: #c1f38e;
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    .container {
      background: #fff;
      max-width: 800px;
      margin: auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,.1);
    }
    h2 { text-align: center; color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; vertical-align: top; }
    th { background-color: #f0f0f0; }
    a.botao {
      background-color: #0d6efd; color: #fff; padding: 6px 12px;
      border-radius: 6px; text-decoration: none; font-weight: bold;
      display: inline-block;
    }
    a.botao:hover { background-color: #084298; }
    .btn-danger {
      background-color: #dc3545; color: #fff; padding: 6px 12px; border-radius: 6px; border: 0; cursor: pointer;
      width: 100%;
    }
    .btn-danger:hover { background-color: #b02a37; }
    .voltar { text-align: center; margin-top: 20px; }
    .voltar a { text-decoration: none; color: #006400; font-weight: bold; }
    .voltar a:hover { text-decoration: underline; }
    .muted { color: #777; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cursos Cadastrados</h2>

    <table>
      <thead>
        <tr>
          <th style="width: 40%">Curso</th>
          <th style="width: 15%">Carga Horária</th>
          <th style="width: 25%">Turmas / NRT*</th>
          <th style="width: 20%">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for curso in cursos %}
          {% set ns = namespace(nrts=[], turmas=[]) %}
          {% for m in matriculas %}
            {% if m.curso == curso.nome %}
              {% if m.nrt and m.nrt not in ns.nrts %}
                {% set _ = ns.nrts.append(m.nrt) %}
              {% endif %}
              {% if m.turma and m.turma not in ns.turmas %}
                {% set _ = ns.turmas.append(m.turma) %}
              {% endif %}
            {% endif %}
          {% endfor %}

          <tr>
            <td><strong>{{ curso.nome }}</strong></td>
            <td>{{ curso.carga_horaria or '—' }}</td>
            <td>
              {% if ns.turmas %}
                <div class="muted">Turmas: {{ ns.turmas|length }}</div>
              {% endif %}
              {% if ns.nrts %}
                <div>
                  NRTs:
                  {% for n in ns.nrts %}
                    <span class="pill">{{ n }}</span>
                  {% endfor %}
                </div>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('editar_curso_form_handler', nome=curso.nome) }}" class="botao">Editar</a>

              <form method="POST" action="{{ url_for('remover_curso') }}"
                    onsubmit="return confirm('Tem certeza que deseja excluir este curso?');"
                    style="margin-top:8px;">
                <input type="hidden" name="curso" value="{{ curso.nome }}">
                <button type="submit" class="btn-danger">Excluir</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p class="muted" style="margin-top:8px;">
      * <strong>Turmas/NRT</strong> são calculados a partir das matrículas do curso.
    </p>

    <div class="voltar">
      <a href="/">← Voltar à Home</a>
    </div>
  </div>
</body>
</html>
