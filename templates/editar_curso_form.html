<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Editar Curso</title>
  <style>
    body { background:#c1f38e; font-family: Arial, sans-serif; margin:0; padding:30px; }
    .container { background:#fff; max-width:980px; margin:auto; padding:24px; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,.1); }
    h2 { text-align:center; margin:0 0 16px; }
    label { font-weight:bold; display:block; margin-top:14px; }
    input[type="text"], input[type="number"], textarea, select { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-top:6px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    .modulo, .pergunta { border:1px solid #e5e5e5; border-radius:8px; padding:12px; margin-top:12px; background:#fafafa; }
    .muted { color:#777; font-size:12px; }
    .btn { background:#0d6efd; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:bold; }
    .btn:hover{ background:#084298; }
    .btn-ghost { background:#eee; color:#333; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .actions { display:flex; gap:10px; margin-top:18px; }
    .danger { color:#b02a37; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Editar Curso: {{ curso.nome }}</h2>

    <form method="post" enctype="multipart/form-data">
      <div class="row">
        <div>
          <label>Nome do Curso</label>
          <input type="text" value="{{ curso.nome }}" readonly>
          <div class="muted">O nome é a chave do curso e não pode ser alterado aqui.</div>
        </div>
        <div>
          <label for="carga_horaria">Carga Horária</label>
          <input id="carga_horaria" name="carga_horaria" type="number" min="0" value="{{ curso.carga_horaria }}">
        </div>
      </div>

      <label for="conteudo">Conteúdo (resumo/ementa)</label>
      <textarea id="conteudo" name="conteudo" rows="4">{{ curso.conteudo }}</textarea>

      <!-- MÓDULOS -->
      <h3 style="margin-top:22px;">Módulos</h3>
      <div id="modulos">
        {% for i, m in enumerate(mods) %}
        <div class="modulo">
          <label>Título do módulo</label>
          <input type="text" name="modulos[{{ i }}][titulo]" value="{{ m.titulo }}">

          <label>Arquivo (opcional para substituir)</label>
          <input type="file" name="modulos[{{ i }}][arquivo]">
          {% if m.arquivo %}
            <div class="muted">Arquivo atual: {{ m.arquivo }}</div>
            <input type="hidden" name="modulos[{{ i }}][arquivo_atual]" value="{{ m.arquivo }}">
          {% endif %}

          <label class="danger" style="display:flex;align-items:center;gap:8px;margin-top:10px;">
            <input type="checkbox" name="modulos[{{ i }}][remover]">
            Remover este módulo
          </label>
        </div>
        {% endfor %}
      </div>
      <div class="actions">
        <button type="button" class="btn-ghost" onclick="addModulo()">+ Adicionar módulo</button>
      </div>

      <!-- PROVA -->
      <h3 style="margin-top:22px;">Prova (Múltipla Escolha)</h3>
      <div id="perguntas">
        {% for i, q in enumerate(perguntas) %}
        <div class="pergunta">
          <label>Enunciado</label>
          <textarea name="perguntas[{{ i }}][enunciado]" rows="2">{{ q.enunciado }}</textarea>

          <div class="row">
            <div>
              <label>Alternativa A</label>
              <input type="text" name="perguntas[{{ i }}][a]" value="{{ q.a }}">
            </div>
            <div>
              <label>Alternativa B</label>
              <input type="text" name="perguntas[{{ i }}][b]" value="{{ q.b }}">
            </div>
            <div>
              <label>Alternativa C</label>
              <input type="text" name="perguntas[{{ i }}][c]" value="{{ q.c }}">
            </div>
            <div>
              <label>Alternativa D</label>
              <input type="text" name="perguntas[{{ i }}][d]" value="{{ q.d }}">
            </div>
          </div>

          <label>Resposta correta</label>
          <select name="perguntas[{{ i }}][correta]">
            <option value=""  {{ ''  == q.correta and 'selected' or '' }}>—</option>
            <option value="a" {{ 'a' == q.correta and 'selected' or '' }}>A</option>
            <option value="b" {{ 'b' == q.correta and 'selected' or '' }}>B</option>
            <option value="c" {{ 'c' == q.correta and 'selected' or '' }}>C</option>
            <option value="d" {{ 'd' == q.correta and 'selected' or '' }}>D</option>
          </select>

          <label class="danger" style="display:flex;align-items:center;gap:8px;margin-top:10px;">
            <input type="checkbox" name="perguntas[{{ i }}][remover]">
            Remover esta pergunta
          </label>
        </div>
        {% endfor %}
      </div>
      <div class="actions">
        <button type="button" class="btn-ghost" onclick="addPergunta()">+ Adicionar pergunta</button>
      </div>

      <div class="actions">
        <button type="submit" class="btn">Salvar Alterações</button>
        <a href="{{ url_for('lista_cursos_para_editar') }}" class="btn-ghost">Cancelar</a>
      </div>
    </form>
  </div>

  <script>
    // adiciona módulo novo
    let modCount = {{ mods|length }};
    function addModulo() {
      const wrap = document.getElementById('modulos');
      const i = modCount++;
      const div = document.createElement('div');
      div.className = 'modulo';
      div.innerHTML = `
        <label>Título do módulo</label>
        <input type="text" name="modulos[${i}][titulo]" value="">
        <label>Arquivo</label>
        <input type="file" name="modulos[${i}][arquivo]">
      `;
      wrap.appendChild(div);
    }

    // adiciona pergunta nova
    let qCount = {{ perguntas|length }};
    function addPergunta() {
      const wrap = document.getElementById('perguntas');
      const i = qCount++;
      const div = document.createElement('div');
      div.className = 'pergunta';
      div.innerHTML = `
        <label>Enunciado</label>
        <textarea name="perguntas[${i}][enunciado]" rows="2"></textarea>
        <div class="row">
          <div>
            <label>Alternativa A</label>
            <input type="text" name="perguntas[${i}][a]">
          </div>
          <div>
            <label>Alternativa B</label>
            <input type="text" name="perguntas[${i}][b]">
          </div>
          <div>
            <label>Alternativa C</label>
            <input type="text" name="perguntas[${i}][c]">
          </div>
          <div>
            <label>Alternativa D</label>
            <input type="text" name="perguntas[${i}][d]">
          </div>
        </div>
        <label>Resposta correta</label>
        <select name="perguntas[${i}][correta]">
          <option value="">—</option>
          <option value="a">A</option>
          <option value="b">B</option>
          <option value="c">C</option>
          <option value="d">D</option>
        </select>
      `;
      wrap.appendChild(div);
    }
  </script>
</body>
</html>
