<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Editar Turmas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#c1f38e; --surface:#fff; --border:#e2e8f0; --text:#1f2937; --muted:#64748b;
      --primary:#a0e76d; --primary-hover:#8dd24a; --shadow:0 8px 22px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Poppins',sans-serif; background:var(--bg); color:var(--text);
      min-height:100vh; display:grid; grid-template-columns:260px 1fr; gap:22px; padding:22px;
    }

    /* ===== Sidebar ===== */
    .sidebar{
      background:var(--surface); border-right:1px solid var(--border);
      padding:18px 16px; display:flex; flex-direction:column; gap:16px;
    }
    .brand{
      background:#f4ffe7; border:1px solid var(--border); border-radius:12px;
      padding:10px; display:flex; align-items:center; justify-content:center;
    }
    .brand img{height:32px;width:auto;display:block}

    .profile{
      background:var(--surface); border:1px solid var(--border); border-radius:12px;
      box-shadow:var(--shadow); padding:14px; display:flex; flex-direction:column; align-items:center; gap:10px;
    }
    .avatar-wrap{position:relative;width:86px;height:86px}
    .avatar{
      width:86px;height:86px;border-radius:50%;
      background-position:center;background-size:cover;background-repeat:no-repeat;
      border:3px solid #d9f5b6;
    }
    .avatar-btn{
      position:absolute;right:-4px;bottom:-4px;background:var(--primary);
      border:none;border-radius:999px;padding:6px 8px;font-weight:700;cursor:pointer;line-height:1;
      box-shadow:0 2px 6px rgba(0,0,0,.15)
    }
    .avatar-btn:hover{background:var(--primary-hover)}
    .user-name{ text-align:center; font-weight:700; color:#222; font-size:14px; text-transform:uppercase; letter-spacing:.02em }

    .btn-side{
      width:100%; display:inline-block; text-align:center;
      padding:10px 14px; border:none; border-radius:10px; cursor:pointer;
      background:var(--primary); color:#333; font-weight:600; text-decoration:none; transition:.15s ease;
    }
    .btn-side:hover{ background:var(--primary-hover) }
    .btn-side.secondary{ background:#eef2f6; color:#111; border:1px solid var(--border) }

    /* ===== Conteúdo ===== */
    .content{ padding-right:22px }
    .card{
      background:#fff; max-width:1100px; margin:0 auto; border-radius:var(--radius);
      padding:22px; box-shadow:var(--shadow); border:1px solid var(--border);
    }
    h2{ text-align:center; margin:0 0 12px; color:#1e293b; font-size:24px; font-weight:700 }

    .toplink{ display:inline-block; margin-bottom:10px; color:#0b5c0b; text-decoration:none; font-weight:700 }
    .toplink:hover{ text-decoration:underline }

    table{ width:100%; border-collapse:separate; border-spacing:0 8px; margin-top:10px }
    thead th{
      background:#fff; padding:12px; text-align:left; font-weight:600; color:#334155;
      border-bottom:2px solid #cbd5e1;
    }
    tbody tr{ background:#fff }
    th,td{ padding:12px; vertical-align:top; border-bottom:1px solid #eef2f7 }
    tbody tr:last-child td{ border-bottom:none }
    tbody tr:hover{ background:#e8f5d7 }

    .btn{
      display:inline-block; background:#7ed957; color:#083; padding:8px 12px;
      border-radius:10px; text-decoration:none; font-weight:700; border:0
    }
    .btn:hover{ filter:brightness(.95) }

    @media (max-width:980px){
      body{ grid-template-columns:1fr; padding:16px }
      .content{ padding-right:0 }
      .card{ padding:16px }
      table{ font-size:14px }
    }
  </style>
</head>
<body>

  <!-- ===== Sidebar ===== -->
  <aside class="sidebar">
    <div class="brand">
      <img src="{{ url_for('static', filename='loggo.png') }}" alt="Ambipar EAD">
    </div>

    <div class="profile">
      <div class="avatar-wrap">
        <div class="avatar"
          style="
            background-image:
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.webp') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.jpeg') }}'),
              url('{{ url_for('static', filename='avatars/' + session['usuario'].replace('@','_at_').replace('.','_') + '.png') }}'),
              url('{{ url_for('static', filename='avatar_padrao.png') }}');
          ">
        </div>
        <button class="avatar-btn" type="button" title="Trocar foto" onclick="document.getElementById('fotoInputProf').click()">✎</button>
        <form id="fotoFormProf" action="{{ url_for('upload_foto') }}" method="POST" enctype="multipart/form-data" style="display:none">
          <input id="fotoInputProf" type="file" name="foto" accept=".png,.jpg,.jpeg,.webp" onchange="document.getElementById('fotoFormProf').submit()">
        </form>
      </div>
      <div class="user-name">{{ (session['nome'] or 'USUÁRIO') | upper }}</div>
    </div>

    <!-- Home do Professor com fallback se a rota não existir -->
    <a class="btn-side secondary" href="/" onclick="return goProfHome(event)">Home do Professor</a>
  </aside>

  <!-- ===== Conteúdo ===== -->
  <main class="content">
    <div class="card">
      <a class="toplink" href="/">← Voltar à Home</a>
      <h2>Editar Turmas</h2>
      <p style="margin:8px 0 12px;color:#555">Agrupado por Curso + Turma</p>

      <table>
        <thead>
          <tr>
            <th>Curso</th>
            <th>Turma</th>
            <th>NRT</th>
            <th>Tipo</th>
            <th>Professor</th>
            <th>Periodicidade</th>
            <th>Período</th>
            <th>Alunos</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for l in linhas %}
          <tr>
            <td>{{ l.curso }}</td>
            <td>{{ l.turma }}</td>
            <td>{{ l.nrt }}</td>
            <td>{{ l.tipo }}</td>
            <td>{{ l.professor }}</td>
            <td>{{ l.periodicidade }}</td>
            <td>
              Início: {{ l.data_inicio }}<br>
              Fim: {{ l.data_fim }}
            </td>
            <td>{{ l.qtd_alunos }}</td>
            <td>
              <a class="btn" href="{{ url_for('editar_turma_detalhe', curso=l.curso, turma=l.turma) }}">Editar</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // Fallback: tenta acessar /home_professor; se falhar, redireciona para "/"
    function goProfHome(e){
      e.preventDefault();
      fetch('/home_professor', { method:'HEAD' })
        .then(r => { if(r.ok){ location.href = '/home_professor'; } else { location.href = '/'; } })
        .catch(() => { location.href = '/'; });
      return false;
    }
  </script>
</body>
</html>
