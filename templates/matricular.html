<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Matricular Aluno</title>
  <style>
    body { background-color:#c1f38e; margin:0; font-family:Arial,sans-serif; display:flex; justify-content:center; align-items:flex-start; height:100vh; padding-top:40px; }
    .box { background:#fff; padding:25px 30px; border-radius:10px; width:360px; box-shadow:0 0 8px rgba(0,0,0,.1); text-align:left; }
    h2 { text-align:center; margin-bottom:25px; color:#333; }
    label { display:block; margin-top:15px; font-weight:bold; color:#444; }
    select, input[type="text"], input[type="date"] { width:100%; padding:8px; margin-top:6px; border-radius:6px; border:1px solid #ccc; font-size:15px; box-sizing:border-box; }
    .hint { font-size:12px; color:#666; margin-top:4px; }
    .erro { margin-top:10px; background:#ffe7e7; color:#a30000; padding:8px 10px; border-radius:6px; font-size:14px; }
    input[type="submit"] { margin-top:25px; width:100%; padding:12px; background:#a0e76d; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:16px; color:#333; transition:background .3s; }
    input[type="submit"]:hover { background:#8dd24a; }
    .link-voltar { display:block; margin-top:20px; text-align:center; text-decoration:none; color:#333; font-weight:bold; }
    .link-voltar:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Matricular Aluno em Curso</h2>

    {% if erro %}
      <div class="erro">{{ erro }}</div>
    {% endif %}

    <form method="post">
      <label for="aluno">Aluno:</label>
      <select name="aluno" id="aluno" required>
        {% for aluno in alunos %}
          <option value="{{ aluno.email }}">{{ aluno.nome }}</option>
        {% endfor %}
      </select>

      <label for="curso">Curso:</label>
      <select name="curso" id="curso" required>
        {% for curso in cursos %}
          <option value="{{ curso.nome }}">{{ curso.nome }}</option>
        {% endfor %}
      </select>

      <label for="professor">Professor:</label>
      <select name="professor" id="professor" required>
        {% for prof in professores %}
          <option value="{{ prof }}">{{ prof }}</option>
        {% endfor %}
      </select>

      <!-- Tipo da matrícula -->
      <label for="tipo">Tipo:</label>
      <select name="tipo" id="tipo" required>
        <option value="Inicial">Inicial</option>
        <option value="Periódico">Periódico</option>
      </select>

      <!-- Turma (3 dígitos, opcional; se vazio o backend gera) -->
      <label for="turma">Turma (3 dígitos):</label>
      <input
        type="text"
        id="turma"
        name="turma"
        placeholder="{{ sugestao_turma or '001' }}"
        inputmode="numeric"
        autocomplete="off"
        pattern="[0-9]{3}"
        title="Use exatamente 3 dígitos (ex.: 001, 002)"
        oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,3)"
      />
      <div class="hint">Se deixar em branco, o sistema gera o próximo número automaticamente.</div>

      <!-- NRT -->
      <label for="nrt">NRT da Turma:</label>
      <input type="text" id="nrt" name="nrt" placeholder="Ex: NRT-2025-01" required>

      <label for="data_inicio">Data Início:</label>
      <input type="date" id="data_inicio" name="data_inicio" required>

      <label for="data_fim">Data Fim:</label>
      <input type="date" id="data_fim" name="data_fim" required>

      <input type="submit" value="Matricular" />
    </form>
    <a href="/" class="link-voltar">Voltar</a>
  </div>

  <script>
    const sugestoesPorCurso = {{ sugestoes_por_curso|tojson|safe if sugestoes_por_curso is defined else '{}' }};
    const cursoSelect = document.getElementById('curso');
    const turmaInput  = document.getElementById('turma');

    function atualizaPlaceholder() {
      const nome = cursoSelect.value;
      const sug = sugestoesPorCurso[nome] || '001';
      turmaInput.placeholder = sug;
      turmaInput.value = '';
    }

    atualizaPlaceholder();
    cursoSelect.addEventListener('change', atualizaPlaceholder);
  </script>
</body>
</html>
