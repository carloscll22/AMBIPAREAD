<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Verificar Vencimentos</title>
  <style>
    body {
      background-color: #f5ffe6;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 { text-align: center; color: #333; margin-bottom: 20px; }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .top-bar a { color: #006400; text-decoration: none; font-weight: bold; }
    .top-bar a:hover { text-decoration: underline; }

    /* Filtros */
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    .filters input, .filters select {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .filters button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .filters .apply { background: #8dd24a; color: #000; }
    .filters .clear { background: #ccc; color: #000; }

    /* Deixa o link "Arquivados" com o MESMO visual dos botões */
    .filters a.archived {
      display: inline-block;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      text-decoration: none;
      background: #0d6efd;
      color: #fff;
    }
    .filters a.archived:hover { filter: brightness(0.95); }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background-color: #fff; }
    tr:hover { background-color: #f0f8e2; }

    .status-pill {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      display: inline-block;
    }
    .status-green { background: #d4edda; color: #155724; }
    .status-yellow { background: #fff3cd; color: #856404; }
    .status-red { background: #f8d7da; color: #721c24; }

    .actions { display: flex; gap: 6px; flex-wrap: wrap; }
    .actions .btn {
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }
    .btn-green { background:#8dd24a; color:#0a0a0a; border:none; }
    .btn-blue  { background:#0d6efd; color:#fff; border:none; }
    .btn-red   { background:#dc3545; color:#fff; border:none; }
    .btn-gray  { background:#6c757d; color:#fff; border:none; }
    .btn:hover { filter: brightness(0.95); }
  </style>
</head>
<body>
  <div class="top-bar">
    <h2>Verificar Vencimentos</h2>
    <a href="/">← Voltar</a>
  </div>

  <!-- Barra de filtros -->
  <div class="filters">
    <input type="text" id="search" placeholder="Buscar por aluno ou curso...">
    <select id="statusFilter">
      <option value="">Todos os Status</option>
      <option value="verde">Em dia</option>
      <option value="amarelo">Vence em ≤ 90 dias</option>
      <option value="vermelho">Vencido</option>
    </select>
    <button class="apply" onclick="aplicarFiltro()">Aplicar</button>
    <button class="clear" onclick="limparFiltro()">Limpar</button>
    <a href="{{ url_for('vencimentos_arquivados') }}" class="archived">Arquivados</a>
  </div>

  <!-- Legenda -->
  <div style="margin-bottom:10px;">
    <span class="status-pill status-green">Em dia</span>
    <span class="status-pill status-yellow">Vence em ≤ 90 dias</span>
    <span class="status-pill status-red">Vencido</span>
  </div>

  <!-- Tabela -->
  <table>
    <thead>
      <tr>
        <th>Aluno</th>
        <th>Curso</th>
        <th><a href="?sort=data">Data de Vencimento</a></th>
        <th><a href="?sort=status">Status</a></th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for l in linhas %}
      <tr>
        <td>{{ l.aluno_nome }}</td>
        <td>{{ l.curso }}</td>
        <td>{{ l.data_venc }}</td>
        <td>
          {% if "Vencido" in l.status %}
            <span class="status-pill status-red">{{ l.status }}</span>
          {% elif "Vence em" in l.status %}
            <span class="status-pill status-yellow">{{ l.status }}</span>
          {% else %}
            <span class="status-pill status-green">{{ l.status }}</span>
          {% endif %}
        </td>
        <td class="actions">
          {% if l.mostrar_matricular %}
            <a class="btn btn-green"
               href="{{ url_for('matricular') }}?aluno={{ l.aluno_email }}&curso={{ l.curso }}">
              Matricular Aluno
            </a>
          {% endif %}
          <a class="btn btn-blue"
             href="{{ url_for('vencimentos_editar', aluno=l.aluno_email, curso=l.curso) }}">
            Editar
          </a>
          <form method="POST" action="{{ url_for('vencimentos_arquivar') }}" style="margin:0;">
            <input type="hidden" name="aluno" value="{{ l.aluno_email }}">
            <input type="hidden" name="curso" value="{{ l.curso }}">
            <button type="submit" class="btn btn-gray">Arquivar</button>
          </form>
          <form method="POST" action="{{ url_for('vencimentos_excluir') }}"
                onsubmit="return confirm('Tem certeza que deseja excluir este vencimento?');"
                style="margin:0;">
            <input type="hidden" name="aluno" value="{{ l.aluno_email }}">
            <input type="hidden" name="curso" value="{{ l.curso }}">
            <button type="submit" class="btn btn-red">Excluir</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    function aplicarFiltro() {
      const termo = document.getElementById("search").value.toLowerCase();
      const statusSel = document.getElementById("statusFilter").value;
      document.querySelectorAll("tbody tr").forEach(row => {
        const aluno = row.cells[0].textContent.toLowerCase();
        const curso = row.cells[1].textContent.toLowerCase();
        const status = row.cells[3].textContent.toLowerCase();

        let mostrar = (aluno.includes(termo) || curso.includes(termo));
        if (statusSel === "verde") mostrar = mostrar && status.includes("em dia");
        if (statusSel === "amarelo") mostrar = mostrar && status.includes("vence em");
        if (statusSel === "vermelho") mostrar = mostrar && status.includes("vencido");

        row.style.display = mostrar ? "" : "none";
      });
    }
    function limparFiltro() {
      document.getElementById("search").value = "";
      document.getElementById("statusFilter").value = "";
      document.querySelectorAll("tbody tr").forEach(row => row.style.display = "");
    }
  </script>
</body>
</html>
