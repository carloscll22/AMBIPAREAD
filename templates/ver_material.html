<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Visualizar Material</title>
  <style>
    body { background:#f5ffe6; font-family: Arial, sans-serif; margin:0; }

    .top-bar { background:#c1f38e; padding:16px 24px; font-weight:bold; font-size:20px; }

    .container {
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:24px;
      padding: 20px 24px;
    }

    /* Menu lateral */
    .menu-lateral {
      background:#ffffff;
      border-radius:12px;
      padding:16px;
      height: calc(100vh - 120px);
      overflow-y:auto;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
    }
    .menu-lateral ul { list-style:none; margin:0; padding:0; }
    .menu-lateral li + li { margin-top:8px; }
    .menu-lateral a {
      display:block;
      padding:10px 12px;
      border-radius:8px;
      color:#222;
      text-decoration:none;
      font-weight:600;
    }
    .menu-lateral a:hover { background:#f0fadf; }
    .menu-lateral a.is-active {
      background:#e8f5d7;
      border-left:4px solid #97de66;
      padding-left:8px;
    }

    /* Conteúdo */
    .conteudo {
      background:#ffffff;
      border-radius:12px;
      padding:16px;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
    }
    iframe {
      width:100%;
      height: calc(100vh - 220px);
      border:1px solid #e6e6e6;
      border-radius:10px;
    }

    /* Progresso */
    .progress { margin-top:16px; background:#eef5e0; border-radius:10px; height:20px; overflow:hidden; position:relative; }
    .progress-bar { height:100%; background:#4CAF50; transition:width .4s; }
    .progress::after {
      content: attr(data-label);
      position:absolute; left:50%; top:0; transform:translateX(-50%);
      font-weight:700; color:#1b1b1b; font-size:12px; line-height:20px;
    }

    /* Navegação */
    .nav-buttons {
      margin-top:16px; display:flex; gap:12px; justify-content:flex-end;
    }
    .btn {
      padding:10px 16px; background:#a0e76d; border:none; border-radius:8px;
      font-weight:700; color:#1b1b1b; cursor:pointer; transition:background .25s;
    }
    .btn:hover { background:#8dd24a; }
    .btn:disabled { background:#dcdcdc; cursor:not-allowed; }

    /* Responsivo */
    @media (max-width: 992px) {
      .container { grid-template-columns: 1fr; }
      .menu-lateral { height:auto; }
      iframe { height: 62vh; }
    }
  </style>
</head>
<body>

  <div class="top-bar">
    Inicial - {{ curso.nome }}
  </div>

  <div class="container">

    <!-- Menu lateral -->
    <div class="menu-lateral">
      <ul>
        {% for idx, mod in enumerate(curso.modulos) %}
          <li>
            <a href="?modulo={{ idx }}" class="{{ 'is-active' if modulo_atual==idx else '' }}">
              Módulo {{ idx + 1 }} - {{ mod.titulo }}
              {% if progresso_individual and progresso_individual[idx] == 100 %} ✅{% endif %}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Conteúdo -->
    <div class="conteudo">
      {% if curso.modulos and modulo_atual is not none %}
        <iframe src="{{ url_for('static', filename=curso.modulos[modulo_atual].arquivo) }}"></iframe>

        <!-- Barra de progresso -->
        <div class="progress" data-label="{{ progresso }}%">
          <div class="progress-bar" style="width: {{ progresso }}%"></div>
        </div>

        <!-- Botões de navegação -->
        <div class="nav-buttons">
          <form method="get" id="form-anterior">
            <input type="hidden" name="modulo" value="{{ (modulo_atual if modulo_atual is not none else 0) - 1 }}">
            <button class="btn" type="submit"
              {% if not curso.modulos or modulo_atual is none or modulo_atual <= 0 %}disabled{% endif %}>
              ← Anterior
            </button>
          </form>
          <form method="get" id="form-proximo">
            <input type="hidden" name="modulo" value="{{ (modulo_atual if modulo_atual is not none else -1) + 1 }}">
            <button class="btn" type="submit"
              {% if not curso.modulos or modulo_atual is none or (modulo_atual + 1) >= (curso.modulos|length) %}disabled{% endif %}>
              Próximo →
            </button>
          </form>
        </div>
      {% else %}
        <p>Selecione um módulo ao lado para visualizar o conteúdo.</p>
      {% endif %}
    </div>

  </div>

  <!-- Script de atalho de teclado -->
  <script>
    document.addEventListener("keydown", function(event) {
      if (event.key === "ArrowLeft") {
        const btnAnterior = document.querySelector("#form-anterior button");
        if (btnAnterior && !btnAnterior.disabled) {
          document.getElementById("form-anterior").submit();
        }
      }
      if (event.key === "ArrowRight") {
        const btnProximo = document.querySelector("#form-proximo button");
        if (btnProximo && !btnProximo.disabled) {
          document.getElementById("form-proximo").submit();
        }
      }
    });
  </script>
</body>
</html>
